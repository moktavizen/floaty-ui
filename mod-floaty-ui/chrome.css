/* Only apply this CSS in Compact Mode */
:root[zen-compact-mode="true"]:not([customizing]) {
  --floaty-bg-color: var(--zen-main-browser-background);
  --floaty-blur-radius: 32px;
  --floaty-blur-saturation: 128%;
  --floaty-margin: var(--mod-floaty-margin);
  --floaty-findbar-top-margin: var(--mod-floaty-findbar-top-margin);
  --floaty-findbar-max-width: var(--mod-floaty-findbar-max-width);
  --floaty-toolbox-padding: 0.35rem;
  --floaty-border-width: 1px;
  --floaty-border-radius: 12px;

  --floaty-blur-filter: blur(var(--floaty-blur-radius))
    saturate(var(--floaty-blur-saturation));
  --floaty-border-style: var(--floaty-border-width) solid
    var(--zen-colors-border-contrast);
  --floaty-separation-margin: calc(
    var(--zen-element-separation) +
    var(--floaty-margin)
  );
  --floaty-sidebar-margin: calc(
    var(--floaty-separation-margin) -
    (var(--zen-element-separation) / 2)
  );
  --floaty-sidebar-margin-total: calc(
    var(--floaty-sidebar-margin) +
    var(--zen-element-separation) +
    1px
  );
  --floaty-bookmark-height: calc(
    30px +
    (var(--floaty-toolbox-padding) * 2) +
    (var(--floaty-border-width) * 2)
  );
  --floaty-bookmark-offset: calc(
    -1 *
    (
      var(--floaty-bookmark-height) +
      (var(--floaty-margin) * 2) +
      var(--zen-element-separation)
    ) +
    1px
  );

  /* Enable blur on Compact Mode */
  .browserSidebarContainer {
    will-change: transform !important;
    backface-visibility: hidden !important;
  }

  /* SIDEBAR ---------------------------------------------------------------- */

  @media (-moz-bool-pref: "mod.floaty.enable-sidebar") {
    @media (-moz-bool-pref: "zen.view.use-single-toolbar") or (-moz-bool-pref: "zen.view.compact.hide-tabbar") {
      #navigator-toolbox {
        padding: var(--floaty-sidebar-margin) !important;
        transition-duration: 100ms !important;

        &:not([zen-right-side="true"]) {
          padding-left: var(--floaty-sidebar-margin-total) !important;
          padding-right: var(--floaty-margin) !important;
        }

        &[zen-right-side="true"] {
          padding-right: var(--floaty-sidebar-margin-total) !important;
          padding-left: var(--floaty-margin) !important;
        }
      }

      #titlebar {
        padding: var(--floaty-toolbox-padding) !important;
        border-radius: var(--floaty-border-radius) !important;

        &::before {
          background: var(--floaty-bg-color) !important;
          backdrop-filter: var(--floaty-blur-filter) !important;
          border: var(--floaty-border-style) !important;
          border-radius: var(--floaty-border-radius) !important;
          box-shadow: var(--zen-big-shadow) !important;
          outline: none !important;
        }

        &::after {
          mix-blend-mode: normal !important;
        }
      }
    }
  }

  /* TOPBAR ----------------------------------------------------------------- */

  @media (-moz-bool-pref: "mod.floaty.enable-topbar") {
    @media (-moz-bool-pref: "zen.view.use-single-toolbar") {
      #zen-appcontent-navbar-wrapper {
        box-sizing: border-box !important;
        position: fixed !important;
        padding: var(--floaty-separation-margin) !important;
        padding-bottom: var(--floaty-margin) !important;
        width: 100% !important;
        height: auto !important;
        opacity: 1 !important;
        top: var(--floaty-bookmark-offset) !important;
        transition: top 0.15s ease-in-out !important;

        &[zen-has-hover="true"],
        &[has-popup-menu],
        &:has(#PlacesChevron[open="true"]) {
          top: 0px !important;
        }

        &:not([zen-has-hover="true"]) {
          transition-delay: 0.1s !important;
        }

        @media (-moz-bool-pref: "zen.view.experimental-no-window-controls") {
          &:has(#PersonalToolbar[collapsed="true"]) {
            display: none !important;
          }
        }
      }

      #zen-appcontent-navbar-container {
        box-sizing: border-box !important;
        position: relative !important;
        padding: var(--floaty-toolbox-padding) !important;
        border-radius: var(--floaty-border-radius) !important;
        opacity: 1 !important;
        min-height: var(--floaty-bookmark-height) !important;

        &::before {
          background: var(--floaty-bg-color) !important;
          backdrop-filter: var(--floaty-blur-filter) !important;
          border: var(--floaty-border-style) !important;
          border-radius: var(--floaty-border-radius) !important;
          box-shadow: var(--zen-big-shadow) !important;
          content: "" !important;
          position: absolute !important;
          inset: 0px !important;
          mix-blend-mode: normal !important;
          opacity: 1 !important;
          z-index: -1 !important;
        }

        &::after {
          content: "" !important;
          position: absolute !important;
          inset: 0 !important;
          background-image: url(chrome://browser/content/zen-images/grain-bg.png) !important;
          pointer-events: none !important;
          z-index: 0 !important;
          opacity: var(--zen-grainy-background-opacity, 0) !important;
        }
      }

      #PersonalToolbar {
        padding-inline: var(--floaty-toolbox-padding) !important;
      }

      .titlebar-buttonbox-container {
        padding-inline: var(--floaty-toolbox-padding) !important;
      }

      #zen-tabbox-wrapper {
        margin: var(--zen-element-separation) !important;
      }
    }

    @media (not (-moz-bool-pref: "zen.view.use-single-toolbar")) and (-moz-bool-pref: "zen.view.compact.hide-toolbar") {
      #zen-appcontent-navbar-wrapper {
        box-sizing: border-box !important;
        position: fixed !important;
        padding: var(--floaty-separation-margin) !important;
        padding-bottom: var(--floaty-margin) !important;
        padding-top: calc(var(--floaty-separation-margin) + 1px) !important;

        &:not([zen-has-hover="true"]) {
          #urlbar:not([breakout-extend="true"]) {
            pointer-events: none !important;
          }
        }
      }

      #zen-appcontent-navbar-container {
        box-sizing: border-box !important;
        position: relative !important;
        padding: var(--floaty-toolbox-padding) !important;
        border-radius: var(--floaty-border-radius) !important;
        background: transparent !important;

        &::before {
          background: var(--floaty-bg-color) !important;
          backdrop-filter: var(--floaty-blur-filter) !important;
          border: var(--floaty-border-style) !important;
          border-radius: var(--floaty-border-radius) !important;
          box-shadow: var(--zen-big-shadow) !important;
          content: "" !important;
          position: absolute !important;
          inset: 0px !important;
          mix-blend-mode: normal !important;
          opacity: 1 !important;
          z-index: -1 !important;
        }

        &::after {
          content: "" !important;
          position: absolute !important;
          inset: 0 !important;
          background-image: url(chrome://browser/content/zen-images/grain-bg.png) !important;
          pointer-events: none !important;
          z-index: 0 !important;
          opacity: var(--zen-grainy-background-opacity, 0) !important;
        }
      }

      #nav-bar {
        margin-left: calc(var(--floaty-toolbox-padding) + 4px) !important;
        margin-right: var(--floaty-toolbox-padding) !important;
      }

      #PersonalToolbar {
        padding-inline: var(--floaty-toolbox-padding) !important;
      }

      #urlbar[breakout-extend="true"]:not([zen-floating-urlbar="true"]) {
        top: calc(
          var(--floaty-separation-margin) +
          var(--floaty-toolbox-padding)
        ) !important;
      }
    }
  }

  /* URL BAR ---------------------------------------------------------------- */

  #urlbar[breakout-extend="true"] > #urlbar-background {
    background: var(--floaty-bg-color) !important;
    backdrop-filter: var(--floaty-blur-filter) !important;

    &::after {
      content: "" !important;
      position: absolute !important;
      inset: 0 !important;
      background-image: url(chrome://browser/content/zen-images/grain-bg.png) !important;
      pointer-events: none !important;
      z-index: 0 !important;
      opacity: var(--zen-grainy-background-opacity, 0) !important;
    }
  }

  .urlbarView-body-inner {
    border-top: var(--floaty-border-style) !important;
  }

  /* FIND BAR --------------------------------------------------------------- */

  @media (-moz-bool-pref: "mod.floaty.enable-findbar") {
    findbar {
      background: var(--floaty-bg-color) !important;
      backdrop-filter: var(--floaty-blur-filter) !important;
      border: var(--floaty-border-style) !important;
      border-radius: var(--floaty-border-radius) !important;
      box-shadow: var(--zen-big-shadow) !important;
      max-width: var(--floaty-findbar-max-width) !important;
      position: fixed !important;
      inset: var(--floaty-findbar-top-margin) var(--floaty-margin) auto !important;
      margin-inline-start: auto !important;
      padding: var(--floaty-toolbox-padding) !important;
      transition: none !important;

      &::after {
        content: "" !important;
        position: absolute !important;
        inset: 0 !important;
        background-image: url(chrome://browser/content/zen-images/grain-bg.png) !important;
        pointer-events: none !important;
        z-index: 0 !important;
        opacity: var(--zen-grainy-background-opacity, 0) !important;
      }
    }

    .findbar-container,
    .findbar-closebutton {
      transition: none !important;
    }

    .findbar-textbox {
      background: var(--zen-toolbar-element-bg) !important;
      border: var(--toolbarbutton-outline) !important;
      border-radius: 8px !important;
      box-shadow: none !important;
    }

    .findbar-find-status {
      display: none !important;
    }
  }

  /* STATUS PANEL ----------------------------------------------------------- */

  @media (-moz-bool-pref: "mod.floaty.enable-statuspanel") {
    #statuspanel {
      background: var(--floaty-bg-color) !important;
      backdrop-filter: var(--floaty-blur-filter) !important;
      border: var(--floaty-border-style) !important;
      border-radius: var(--floaty-border-radius) !important;
      box-shadow: var(--zen-big-shadow) !important;
      padding: 2px 9px !important;
      margin: var(--floaty-margin) !important;

      &::after {
        content: "" !important;
        position: absolute !important;
        inset: 0 !important;
        background-image: url(chrome://browser/content/zen-images/grain-bg.png) !important;
        pointer-events: none !important;
        z-index: 0 !important;
        opacity: var(--zen-grainy-background-opacity, 0) !important;
        border-radius: inherit !important;
      }
    }

    #statuspanel-label {
      background: transparent !important;
      padding: 0px !important;
      border: 0px !important;
      margin: 0px !important;
    }
  }
}
